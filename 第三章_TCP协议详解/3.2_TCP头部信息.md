## 3.2 TCP头部信息

[**TCP头部结构**](../常见协议报文格式及解析.md#一tcp协议)

### 3.2.1 使用tcpdump查看观察TCP头部信息.

我们使用2.2.1节中抓取的数据,分析其中TCP协议相关部分
``````shell
IP 127.0.0.1.51566 > 127.0.0.1.telnet: Flags [S], seq 3134843833, win 43690, options [mss 65495,sackOK,TS val 69144573 ecr 0,nop,wscale 7], length 0
	0x0000:  4510 003c e444 4000 4006 5865 7f00 0001
	0x0010:  7f00 0001 c96e 0017 bad9 ebb9 0000 0000
	0x0020:  a002 aaaa fe30 0000 0204 ffd7 0402 080a
	0x0030:  041f 0ffd 0000 0000 0103 0307
``````
* **Flags[S]:** 表示该报文段含SYN标志,因此这是一个同步报文段。如果该TCP报文段含其他标志,Flags[]会将其首字母放入其中。
* **seq:** 序号值。因为这是127.0.0.1.51566 > 127.0.0.1.telnet 该方向上的第一个TCP报文段,所以该序号值是该通信方向上的ISN值。因为这是第一个TCP报文段,所以它没有针对对方发来的TCP报文段的确认值。
* **win 43690:** 窗口大小。由于这是同步报文段,所以这是实际窗口大小。
* **options:** 选项字段。
* **mss 65495** 最大报文段大小。使用ifconfig命令查看,回路接口MTU=65536。因此预想到mss=MTU-40字节。
* **sackOK:** 表示同意使用SACK选项。
* **TSval 69144573:** 发送端时间戳。
* **erc 0:** 时间戳回显应答,由于这是第一个TCP报文段,所以值为0(尚未收到对方时间戳)。
* **nop:** 空操作。
* **wscale:** 窗口拓展因子。

**TCP头部字节码解析:**

|十六进制数|十进制数|TCP头部信息|
|---------|-------|-----------|
|0xc96e|51566|源端口号|
|0x0017|23|目的端口号|
|0xbad9ebb9|3134843833|序号|
|0x00000000|0|确认号|
|0xa|10|TCP头部长度为10个32位(40字节)|
|0x002||包括6位保留字段,设置6位标志字段的第2位(SYN)|
|0xaaaa|43690|窗口大小|
|0xfe30||头部校验和|
|0x0000||未设置URG标志,紧急指针无意义|
|0x02|2|kind = 2 最大报文长度选项|
|0x04|4|length = 4 选项总长度|
|0xffd7|65495|最大报文段大小|
|0x04|4|kind = 4 同意使用SACK|
|0x02|2|length = 2 选项总长度|
|0x08|8|kind =8 时间戳选项|
|0x0a|10|length = 10 选项总长度|
|0x041f0ffd|69144573|时间戳值|
|0x00000000|0|时间戳回显应答|
|0x01|1|kind =1 空操作选项|
|0x03|3|kind =3 窗口扩大因子选项|
|0x03|3|length = 3 选项总长度|
|0x07|7|扩展因子值|


