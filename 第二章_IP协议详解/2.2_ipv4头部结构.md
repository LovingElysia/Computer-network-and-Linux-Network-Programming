## 2.2 IPv4头部结构

* **[Ipv4头部结构及解析](../常见协议报文格式及解析.md#二ip协议)**
  
### 2.2.1 使用tcpdump观察Ipv4头部结构

* **在anonymous上执行**：
``````shell
$sudo tcpdump -ntx -i lo #监听本地回环端口
$telnet 127.0.0.1 #在另一个终端登录本地主句
``````
* **查看输出**
``````shell
IP 127.0.0.1.51566 > 127.0.0.1.telnet: Flags [S], seq 3134843833, win 43690, options [mss 65495,sackOK,TS val 69144573 ecr 0,nop,wscale 7], length 0
	0x0000:  4510 003c e444 4000 4006 5865 7f00 0001
	0x0010:  7f00 0001 c96e 0017 bad9 ebb9 0000 0000
	0x0020:  a002 aaaa fe30 0000 0204 ffd7 0402 080a
	0x0030:  041f 0ffd 0000 0000 0103 0307
IP 127.0.0.1.telnet > 127.0.0.1.51566: Flags [R.], seq 0, ack 3134843834, win 0, length 0
	0x0000:  4510 0028 9dd4 4000 4006 9ee9 7f00 0001
	0x0010:  7f00 0001 0017 c96e 0000 0000 bad9 ebba
	0x0020:  5014 0000 41b4 0000
#“Flags”、“seq”、“win”和“options”描述的都是TCP头部信息
``````
其中第一行数据就是我们IPv4头部结构信息,tcpdump -x选项将以十六进制码输出数据报的二进制码
* **IPv4个头部各字段详解**

|十六进制数|十进制表示|IP头部信息|
|---------|---------|----------|
|0x4|4|IP版本号(4位)|
|0x5|5|IP头部长度(4位):5个32bit字(20字节)|
|0x10||开启最小时延服务|
|0x003c|60|(16位)总长度:60字节|
|0xe444||(16位)数据报标识|
|0x4||设置禁止分片|
|0x000||(13位)片偏移量为0|
|0x40|64|(8位)生存时间:64跳|
|0x06|6|(8位)协议:TCP|
|0x5865||16(位)头部校验和|
|0x7f000001||(32位)源端IP地址|
|0x7f000001||(32位)目的端IP地址|

**注：** 空白的部分是我们不关心的十进制。16六进制的每一位代表4个二进制位
